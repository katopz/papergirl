<!DOCTYPE html>
<html lang="en-us">
  <head>
    <meta charset="UTF-8">
    <title>Papergirl by katopz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" type="text/css" href="stylesheets/normalize.css" media="screen">
    <link href='https://fonts.googleapis.com/css?family=Open+Sans:400,700' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/github-light.css" media="screen">
  </head>
  <body>
    <section class="page-header">
      <h1 class="project-name">Papergirl</h1>
      <h2 class="project-tagline">XHR with ETAG via localForage</h2>
      <a href="https://github.com/katopz/papergirl" class="btn">View on GitHub</a>
      <a href="https://github.com/katopz/papergirl/zipball/master" class="btn">Download .zip</a>
      <a href="https://github.com/katopz/papergirl/tarball/master" class="btn">Download .tar.gz</a>
    </section>

    <section class="main-content">
      <blockquote>
<p>PS : In heavy development, please leave her alone for now. :)</p>
</blockquote>

<h1>
<a id="papergirl" class="anchor" href="#papergirl" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Papergirl</h1>

<p>Papergirl will deliver content when you make a request. She's smart enough<br>
to let you know that you already have content in your hand by <code>etag</code><br>
so you will save your time going to remote server and be happy using local content.   </p>

<pre><code>                                 ┌───(304)────────────────────────── not_mod ──┐ 
                                 │         ┌─ insert ─┐                        │ ┌─ done
 request ─┬─────────┬─ send ── load ─(200)─┤          ├─ upsert ─┬── sync ─────┴─┤
          └─ cache ─┘                      ├─ update ─┘          │               └─ error
               ▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪▪└──────────── match ──┘
</code></pre>

<h1>
<a id="stack" class="anchor" href="#stack" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Stack</h1>

<ul>
<li>[x] Persistent Data : <a href="https://github.com/mozilla/localForage">https://github.com/mozilla/localForage</a>
</li>
<li>[ ] Compression : <a href="https://github.com/pieroxy/lz-string">https://github.com/pieroxy/lz-string</a>
</li>
</ul>

<h1>
<a id="install" class="anchor" href="#install" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Install</h1>

<div class="highlight highlight-source-shell"><pre>npm install papergirl --save</pre></div>

<h1>
<a id="how-to-use" class="anchor" href="#how-to-use" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to use</h1>

<h3>
<a id="request-and-watch-as-functional" class="anchor" href="#request-and-watch-as-functional" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request and watch as functional.</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">papergirl</span>.<span class="pl-c1">watch</span>()
    <span class="pl-c">// Occur when got cached data.</span>
    .<span class="pl-en">onCache</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(data);
    })
    <span class="pl-c">// Never Cached this data before.  </span>
    .<span class="pl-en">onInsert</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onInsert:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Cached exist but data is mismatch.</span>
    .<span class="pl-en">onUpdate</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onUpdate:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Something wrong.</span>
    .<span class="pl-c1">onError</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(error);
    })
    .<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>foo.json<span class="pl-pds">'</span></span>);</pre></div>

<h3>
<a id="request-and-watch-as-functional-with-localhost-fallback" class="anchor" href="#request-and-watch-as-functional-with-localhost-fallback" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request and watch as functional with <strong>localhost</strong> fallback.</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">papergirl</span>.<span class="pl-c1">watch</span>()
    <span class="pl-c">// Occur when got cached data.</span>
    .<span class="pl-en">onCache</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(data);
    })
    <span class="pl-c">// Never Cached this data before.  </span>
    .<span class="pl-en">onInsert</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onInsert:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Cached exist but data is mismatch.</span>
    .<span class="pl-en">onUpdate</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onUpdate:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Something wrong.</span>
    .<span class="pl-c1">onError</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(error);
    })
    <span class="pl-c">// Use this uri when at localhost origin.</span>
    .<span class="pl-en">local</span>(<span class="pl-s"><span class="pl-pds">'</span>bar.json<span class="pl-pds">'</span></span>)
    <span class="pl-c">// Make remote request.</span>
    .<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>foo.json<span class="pl-pds">'</span></span>);</pre></div>

<h3>
<a id="request-and-watch-every-methods-as-functional" class="anchor" href="#request-and-watch-every-methods-as-functional" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Request and watch every methods as functional.</h3>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">papergirl</span>.<span class="pl-c1">watch</span>()
    <span class="pl-c">// Cached exist.</span>
    .<span class="pl-en">onCache</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onCache:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Intercept xhr request to modify headers before send.</span>
    .<span class="pl-en">onSend</span>(<span class="pl-k">function</span>(<span class="pl-smi">xhr</span>) {
        <span class="pl-smi">xhr</span>.<span class="pl-c1">setRequestHeader</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>);
    })
    <span class="pl-c">// Intercept xhr while onload</span>
    .<span class="pl-c1">onLoad</span>(<span class="pl-k">function</span>(<span class="pl-smi">xhr</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(xhr);
    })
    <span class="pl-c">// Never Cached this data before.  </span>
    .<span class="pl-en">onInsert</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onInsert:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Cached exist but data is mismatch.</span>
    .<span class="pl-en">onUpdate</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onUpdate:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Occur when insert or update cache from remote.</span>
    .<span class="pl-en">onUpsert</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onUpsert:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Cache data is match with remote data.</span>
    .<span class="pl-en">onMatch</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>match:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Occur after 200 OK and cached done.</span>
    .<span class="pl-en">onSync</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onSync:<span class="pl-pds">'</span></span> <span class="pl-k">+</span> data);
    })
    <span class="pl-c">// Something wrong.</span>
    .<span class="pl-c1">onError</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>onError : <span class="pl-pds">'</span></span> <span class="pl-k">+</span> error);
    })
    <span class="pl-c">// Use this uri when at localhost origin.</span>
    .<span class="pl-en">local</span>(<span class="pl-s"><span class="pl-pds">'</span>bar.json<span class="pl-pds">'</span></span>)
    <span class="pl-c">// Make remote request.</span>
    .<span class="pl-en">request</span>(<span class="pl-s"><span class="pl-pds">'</span>foo.json<span class="pl-pds">'</span></span>);</pre></div>

<h1>
<a id="how-to-use-as-options-and-promise" class="anchor" href="#how-to-use-as-options-and-promise" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>How to use as options and promise.</h1>

<div class="highlight highlight-source-js"><pre><span class="pl-smi">papergirl</span>.<span class="pl-en">getCacheFirst</span>(<span class="pl-s"><span class="pl-pds">'</span>foo.json<span class="pl-pds">'</span></span>, {
    <span class="pl-c">// Occur when got cached data.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">cache</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(data);
    },
    <span class="pl-c">// Intercept xhr request to modify headers before send.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">beforeSend</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">xhr</span>) {
        <span class="pl-smi">xhr</span>.<span class="pl-c1">setRequestHeader</span>(<span class="pl-s"><span class="pl-pds">'</span>foo<span class="pl-pds">'</span></span>, <span class="pl-s"><span class="pl-pds">'</span>bar<span class="pl-pds">'</span></span>);
    },
    <span class="pl-c">// Intercept xhr while onload</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">onload</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">xhr</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(xhr);
    },
    <span class="pl-c">// Occur when never cache before and get insert from remote.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">insert</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>insert<span class="pl-pds">'</span></span>);
    },
    <span class="pl-c">// Cached but not match from remote.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">update</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>update<span class="pl-pds">'</span></span>);
    },
    <span class="pl-c">// Cache is upsert from remote.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">upsert</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>upsert<span class="pl-pds">'</span></span>);
    },
    <span class="pl-c">// Cache data is match with remote data.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">match</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>match<span class="pl-pds">'</span></span>);
    },
    <span class="pl-c">// Cache is match with remote by ETag.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">not_mod</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>not_mod<span class="pl-pds">'</span></span>);
    },
    <span class="pl-c">// Occur after 200 OK and cached done.</span>
    <span class="pl-s"><span class="pl-pds">'</span><span class="pl-en">sync</span><span class="pl-pds">'</span></span><span class="pl-k">:</span> <span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
        <span class="pl-en">console</span>.<span class="pl-c1">log</span>(<span class="pl-s"><span class="pl-pds">'</span>sync<span class="pl-pds">'</span></span>);
    }
}).<span class="pl-en">then</span>(<span class="pl-k">function</span>(<span class="pl-smi">data</span>) {
    <span class="pl-c">// Done.</span>
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(data);
}).<span class="pl-en">catch</span>(<span class="pl-k">function</span>(<span class="pl-smi">error</span>) {
    <span class="pl-c">// Something wrong.</span>
    <span class="pl-en">console</span>.<span class="pl-c1">log</span>(error);
});</pre></div>

<h1>
<a id="options" class="anchor" href="#options" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Options</h1>

<ul>
<li>[x] <code>cache</code> : Occur when got cached data.</li>
<li>[x] <code>beforeSend</code>: Intercept xhr request usually to modify headers before send.</li>
<li>[x] <code>onload</code>: Intercept xhr while onload.</li>
<li>[x] <code>insert</code> : Occur when never cache before and get insert from remote.</li>
<li>[x] <code>update</code> : Cached but not match from remote.</li>
<li>[x] <code>upsert</code> : Cache get <code>insert</code> or <code>update</code> from remote.</li>
<li>[x] <code>match</code> : Cache data is match with remote data.</li>
<li>[x] <code>not_mod</code> : Cache is match with remote by ETag.</li>
<li>[x] <code>sync</code> : Occur after 200 or 304 and cached done.</li>
</ul>

<h1>
<a id="todo" class="anchor" href="#todo" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>TODO</h1>

<ul>
<li>[x] Test strategy.cacheFirst.</li>
<li>[ ] Test strategy.networkFirst.</li>
<li>[ ] Test strategy.cacheOnly.</li>
<li>[ ] Test strategy.networkOnly.</li>
<li>[ ] Test parallel requests.</li>
<li>[ ] Implement optional <code>etag</code>. // useIfNoneMatch</li>
<li>[ ] Implement optional <code>last-modified</code>. // useLastModify</li>
<li>[ ] Implement <code>last-modified</code> fallback.</li>
<li>[ ] Test <code>last-modified</code> fallback.</li>
<li>[x] Test ready.</li>
<li>[ ] Support multiple <code>storeName</code>.</li>
<li>[ ] Support <code>Cache-Control: max-age</code>.</li>
<li>[ ] Support xhr.responseTextType = 'json'.</li>
<li>[ ] Ignore query when cache.</li>
</ul>

      <footer class="site-footer">
        <span class="site-footer-owner"><a href="https://github.com/katopz/papergirl">Papergirl</a> is maintained by <a href="https://github.com/katopz">katopz</a>.</span>

        <span class="site-footer-credits">This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the <a href="https://github.com/jasonlong/cayman-theme">Cayman theme</a> by <a href="https://twitter.com/jasonlong">Jason Long</a>.</span>
      </footer>

    </section>

  
  </body>
</html>
